---
title: "psts_plot"
author: "Juliana Cornett"
date: "2023-08-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#code to generate plot of PST levels over the course of the summer (Figure 3 in manuscript?)

#install packages (ggplot2 & ggpubr for creating figure)

```{r}
#install.packages("ggplot2")
#install.packages("ggpubr")
```

#load libraries

```{r}
library(ggplot2)
library(ggpubr)
```

#read in ELISA PSTs data

```{r}
oyster_psts <- read.csv("../Data/Oyster_PSTs.csv")
alex <- read.csv("../Data/Alexandrium_MicroscopeCounts.csv")
```

#format dates

```{r}
oyster_psts$Date <- as.Date(oyster_psts$Date, "%m/%d/%Y")
alex$Date <- as.Date(alex$Date, "%m/%d/%Y")
```

```{r}
sunset_5 <- hcl.colors(5, palette = "Sunset")
```

```{r}
"#704D9E" "#BC5AA9" "#ED7C97" "#F9B282" "#F3E79A"
```

#timeseries plot 

```{r}
pst_plot <- ggplot(oyster_psts, aes(x = Date, y = Tox_ug_100g, fill = Method)) +
  geom_point(size = 5, shape = 21) +
  scale_fill_manual(values = c("#F3E79A", "#704D9E")) +
  theme_pubr() +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y") +
  labs(x = NULL, y = "PSTs in Oyster Tissue (ug/100g)") +
    theme(legend.position = "right") +
  geom_hline(yintercept = 80, linetype = "dashed") +
  geom_hline(yintercept = 34, linetype = "dotted")
pst_plot
```

#save as jpeg

```{r}
jpeg("../Figures/Fig3.jpg", width = 8, height = 5, units="in", res=600)
pst_plot
```

#correlation between ELISA and phytoplankton counts

#subset psts df into ELISA only

```{r}
elisa_psts <- subset(oyster_psts, Method == "ELISA")
```

#join ELISAs df with alex count df where dates in alex count df are in ELISA df

```{r}
elisa_alex <- merge(elisa_psts, alex, by = "Date")
```

#calculate Pearson's correlation between net tow and ELISA

```{r}
correlation_elisa_net <- cor.test(elisa_alex$Tox_ug_100g, elisa_alex$Count_Net, method = "pearson")
correlation_elisa_net
```

#visualize relationship between net tow and ELISA

```{r}
plot_elisa_net <- ggplot(elisa_alex, aes(Count_Net, Tox_ug_100g)) + geom_point() + geom_smooth(method = "lm") + theme_pubr()
plot_elisa_net
```

#calculate Pearson's correlation between 1m and ELISA

```{r}
correlation_elisa_1m <- cor.test(elisa_alex$Tox_ug_100g, elisa_alex$Count_1m_L, method = "pearson")
correlation_elisa_1m
```

#visualize relationship between 1m and ELISA

```{r}
plot_elisa_1m <- ggplot(elisa_alex, aes(Count_1m_L, Tox_ug_100g)) + geom_point() + geom_smooth(method = "lm") + theme_pubr()
plot_elisa_1m
```

#calculate Pearson's correlation between 5m and ELISA

```{r}
correlation_elisa_5m <- cor.test(elisa_alex$Tox_ug_100g, elisa_alex$Count_5m_L, method = "pearson")
correlation_elisa_5m
```

#visualize relationship between 5m and ELISA

```{r}
plot_elisa_5m <- ggplot(elisa_alex, aes(Count_5m_L, Tox_ug_100g)) + geom_point() + geom_smooth(method = "lm") + theme_pubr()
plot_elisa_5m
```

#ANOVAs between DEC tox categories and other variables

#create new categorical column in tox data with 3 values: 1) <34 ug/100g, 2) >34 and <80 ug/100g, 3) >80 ug/100g

```{r}

```

