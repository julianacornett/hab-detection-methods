---
title: "psts_plot"
author: "Juliana Cornett"
date: "2023-08-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#code to generate plot of PST levels over the course of the summer (Figure 4 in manuscript?)

#install packages (ggplot2 & ggpubr for creating figure)

```{r}
#install.packages("ggplot2")
#install.packages("ggpubr")
```

#load libraries

```{r}
library(ggplot2)
library(ggpubr)
```

#read in ELISA PSTs data

```{r}
oyster_psts <- read.csv("../Data/Oyster_PSTs.csv")
alex <- read.csv("../Data/Alexandrium_MicroscopeCounts.csv")
```

#format dates

```{r}
oyster_psts$Date <- as.Date(oyster_psts$Date, "%m/%d/%Y")
alex$Date <- as.Date(alex$Date, "%m/%d/%Y")
```

```{r}
sunset_5 <- hcl.colors(5, palette = "Sunset")
```

#timeseries plot 

```{r}
pst_plot <- ggplot(oyster_psts, aes(x = Date, y = Tox_ug_100g, fill = Method)) +
  geom_point(size = 5, shape = 21) +
  scale_fill_manual(values = c("#F3E79A", "#704D9E")) +
  theme_pubr() +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y") +
  labs(x = NULL, y = "PSTs in Oyster Tissue (ug/100g)") +
    theme(legend.position = "right") +
  geom_hline(yintercept = 80, linetype = "dashed") +
  geom_hline(yintercept = 34, linetype = "dotted")
pst_plot
```

#save as jpeg

```{r}
jpeg("../Figures/Fig4.jpg", width = 8, height = 5, units="in", res=600)
pst_plot
```

#correlation between ELISA and mouse bioassay

#read in csv

```{r}
pst_grouped <- read.csv("../Data/PSTs_byWeek.csv")
```

```{r}
elisa_dec_corr <- ggplot(pst_grouped, aes(x = PST_ELISA, y = PST_DEC)) + 
  geom_point(size = 4) + 
  stat_poly_line(se = FALSE, size = 2, color = "black") +
  stat_poly_eq(use_label(c("R2", "p"))) +
  theme_pubr() +
  ylab("PSTs from mouse bioassay (ug/100g)") +
  xlab("PSTs from ELISA (ug/100g)") 
elisa_dec_corr
```

#save as jpeg

```{r}
jpeg("../Figures/ELISA_DEC_Correlation.jpg", width = 8, height = 5, units="in", res=600)
elisa_dec_corr
```


#correlation between ELISA and phytoplankton counts

#subset psts df into ELISA only

```{r}
elisa_psts <- subset(oyster_psts, Method == "ELISA")
```

#join ELISAs df with alex count df where dates in alex count df are in ELISA df

```{r}
elisa_alex <- merge(elisa_psts, alex, by = "Date")
```

#calculate linear regression between 1m and ELISA

```{r}
lm_elisa_1m <- lm(elisa_alex$Tox_ug_100g ~ elisa_alex$Count_1m_L)
summary(lm_elisa_1m)
```

#try logarithmic 

```{r}
log_elisa_1m <- lm(elisa_alex$Tox_ug_100g ~ log(elisa_alex$Count_1m_L))
summary(log_elisa_1m)
```

#try exponential

```{r}
exp_elisa_1m <- lm(log(elisa_alex$Tox_ug_100g) ~ elisa_alex$Count_1m_L)
summary(exp_elisa_1m)
```

#try quadratic

```{r}
quad_elisa_1m <- lm(elisa_alex$Tox_ug_100g ~ poly(elisa_alex$Count_1m_L,2))
summary(quad_elisa_1m)
```

#visualize relationship between 1m and ELISA

```{r}
plot_elisa_1m <- ggplot(elisa_alex, aes(Count_1m_L, Tox_ug_100g)) + geom_point() +
  stat_smooth() + 
  theme_pubr()
plot_elisa_1m
```

#calculate linear regression between 5m and ELISA

```{r}
lm_elisa_5m <- lm(elisa_alex$Tox_ug_100g ~ elisa_alex$Count_5m_L)
summary(lm_elisa_5m)
```

#visualize relationship between 5m and ELISA

```{r}
plot_elisa_5m <- ggplot(elisa_alex, aes(Count_5m_L, Tox_ug_100g)) + geom_point() + geom_smooth(method = "lm") + theme_pubr()
plot_elisa_5m
```
