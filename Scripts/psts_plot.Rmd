---
title: "psts_plot"
author: "Juliana Cornett"
date: "2023-08-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#code to generate plot of PST levels over the course of the summer (Figure 4 in manuscript?)

#install packages (ggplot2, ggpubr, ggpmisc, & patchwork for creating figure)

```{r}
#install.packages("ggplot2")
#install.packages("ggpubr")
#install.package("ggpmisc")
#install.packages("patchwork")
```

#load libraries

```{r}
library(ggplot2)
library(ggpubr)
library(ggpmisc)
library(patchwork)
```

#read in ELISA PSTs data

```{r}
oyster_psts <- read.csv("../Data/Oyster_PSTs.csv")
alex_count <- read.csv("../Data/Alexandrium_MicroscopeCounts.csv")
qpcr_quant <- read.csv("../Data/Alexandrium_qPCR_Results.csv")
```

#format 

```{r}
oyster_psts$Date <- as.Date(oyster_psts$Date, "%m/%d/%Y")
alex_count$Date <- as.Date(alex_count$Date, "%m/%d/%Y")
qpcr_quant$Date <- as.Date(qpcr_quant$Date, "%m/%d/%Y")
qpcr_quant <- subset(qpcr_quant, qpcr_quant$Sample_Type == "Sample")
qpcr_quant <- subset(qpcr_quant, qpcr_quant$Quantity_Corrected >= 63.98)
```

```{r}
merged_long <- read.csv("../Data/PST_Pairs_Long_v2.csv")
```

#create new df with daily mean quantity

```{r}
qpcr_dailyMean <- aggregate(Copies_L_Corrected ~ Date, data = qpcr_quant, FUN = mean)
```

#correlation between ELISA and mouse bioassay

#read in csv

```{r}
pst_pairs <- read.csv("../Data/PST_Pairs_v2.csv")
```

```{r}
elisa_dec_corr <- ggplot(pst_pairs, aes(x = PST_MBA_ug_100g, y = PST_ELISA_ug_100g)) + 
  geom_point(size = 4, shape = 1) + 
  stat_poly_line(se = FALSE, size = 2, color = "black") +
  stat_poly_eq(use_label(c("R2", "p"))) +
  theme_pubr() +
  xlab("PSTs from mouse bioassay (\u00b5g/100g)") +
  ylab("PSTs from ELISA (\u00b5g/100g)")
elisa_dec_corr
```

#save as jpeg

```{r}
jpeg("../Figures/Fig3.jpg", width = 8, height = 5, units="in", res=600)
elisa_dec_corr
```

#add log-transformed qpcr column

```{r}
merged_long$log_qpcr <- log(merged_long$Copies_L)
```

#correlation between qPCR versus ELISA and MBA PSTs

```{r}
  qpcr_tox <- ggplot(merged_long, aes(x = log_qpcr, y = Tox_ug_100g, color = Method, fill = Method, shape = Method)) + 
  scale_fill_manual(values = c("darkgray", "black"), labels = c("ELISA", "MBA")) +
  scale_color_manual(values = c("darkgray", "black"), labels = c("ELISA", "MBA")) +
  scale_shape_manual(values = c(21,24), labels = c("ELISA", "MBA")) +
  geom_point(size = 4, color = "black", alpha = 0.75) + 
  stat_poly_line(se = FALSE, size = 2) +
  stat_poly_eq(use_label(c("R2", "p"))) +
  theme_pubr() +
  labs(
    x = "Mean log-transformed *A. catenella* qPCR Quantity (Copies/L)",
    y = "PSTs (\u00b5g/100g)") +
  theme(legend.position = "right", axis.title.x = ggtext::element_markdown(), axis.title.y = ggtext::element_markdown()) +
  geom_hline(yintercept = 80, linetype = "dashed") +
  geom_hline(yintercept = 34, linetype = "dotted")
qpcr_tox
```

#save as jpeg

```{r}
jpeg("../Figures/Fig4.jpg", width = 8, height = 5, units="in", res=600)
qpcr_tox
```

#calculate linear regression between ELISA and MBA

```{r}
lm_elisa_mba <- lm(pst_pairs$PST_ELISA_ug_100g ~ pst_pairs$PST_MBA_ug_100g)
summary(lm_elisa_mba)
```

#calculate linear regression between qPCR and MBA

```{r}
lm_mba_qpcr <- subset(merged_long, Method == "MBA") 
lm_mba_qpcr <- lm(lm_mba_qpcr$log_qpcr ~ lm_mba_qpcr$Tox_ug_100g)
summary(lm_mba_qpcr)
```

#calculate linear regression between qPCR and ELISA

```{r}
lm_elisa_qpcr <- subset(merged_long, Method == "ELISA") 
lm_elisa_qpcr <- lm(lm_elisa_qpcr$log_qpcr ~ lm_elisa_qpcr$Tox_ug_100g)
summary(lm_elisa_qpcr)
```

#plot of 1m correlation with mba/elisa

```{r}
corr_1m_tox <- ggplot(merged_long, aes(x = Count_1m_L, y = Tox_ug_100g, color = Method, fill = Method, shape = Method)) + 
  scale_fill_manual(values = c("darkgray", "black"), labels = c("ELISA", "MBA")) +
  scale_color_manual(values = c("darkgray", "black"), labels = c("ELISA", "MBA")) +
  scale_shape_manual(values = c(21,24), labels = c("ELISA", "MBA")) +
  geom_point(size = 4, color = "black", alpha = 0.75) + 
  stat_poly_line(se = FALSE, size = 2) +
  stat_poly_eq(use_label(c("R2", "p"))) +
  theme_pubr() +
  labs(
    x = "*A. catenella* Count (cells/L)",
    y = "PSTs (\u00b5g/100g)") +
  theme(legend.position = "right", axis.title.x = ggtext::element_markdown()) +
  geom_hline(yintercept = 80, linetype = "dashed") +
  geom_hline(yintercept = 34, linetype = "dotted") +
  annotate("text", x=1450, y=250, label = "A", size = 5) 
corr_1m_tox
```

#plot of 5m correlation with mba/elisa

```{r}
corr_5m_tox <- ggplot(merged_long, aes(x = Count_5m_L, y = Tox_ug_100g, color = Method, fill = Method, shape = Method)) + 
  scale_fill_manual(values = c("darkgray", "black"), labels = c("ELISA", "MBA")) +
  scale_color_manual(values = c("darkgray", "black"), labels = c("ELISA", "MBA")) +
  scale_shape_manual(values = c(21,24), labels = c("ELISA", "MBA")) +
  geom_point(size = 4, color = "black", alpha = 0.75) + 
  stat_poly_line(se = FALSE, size = 2) +
  stat_poly_eq(use_label(c("R2", "p"))) +
  theme_pubr() +
  labs(
    x = "*A. catenella* Count (cells/L)",
    y = "PSTs (\u00b5g/100g)") +
  theme(legend.position = "right", axis.title.x = ggtext::element_markdown()) +
  geom_hline(yintercept = 80, linetype = "dashed") +
  geom_hline(yintercept = 34, linetype = "dotted") +
  annotate("text", x=1450, y=250, label = "B", size = 5) 
corr_5m_tox
```

#plot of net tow correlation with mba/elisa

```{r}
corr_net_tox <- ggplot(merged_long, aes(x = Count_Net, y = Tox_ug_100g, color = Method, fill = Method, shape = Method)) + 
  scale_fill_manual(values = c("darkgray", "black"), labels = c("ELISA", "MBA")) +
  scale_color_manual(values = c("darkgray", "black"), labels = c("ELISA", "MBA")) +
  scale_shape_manual(values = c(21,24), labels = c("ELISA", "MBA")) +
  geom_point(size = 4, color = "black", alpha = 0.75) + 
  stat_poly_line(se = FALSE, size = 2) +
  stat_poly_eq(use_label(c("R2", "p"))) +
  theme_pubr() +
  labs(
    x = "*A. catenella* Count (cells)",
    y = "PSTs (\u00b5g/100g)") +
  theme(legend.position = "right", axis.title.x = ggtext::element_markdown()) +
  geom_hline(yintercept = 80, linetype = "dashed") +
  geom_hline(yintercept = 34, linetype = "dotted") +
  annotate("text", x=8.5, y=250, label = "C", size = 5) 
corr_net_tox
```

#combined plot

```{r}
jpeg("../Figures/Fig5.jpg", width = 8, height = 12, units="in", res=600)
corr_1m_tox /
  corr_5m_tox /
  corr_net_tox
```

#calculate linear regression between 1m and ELISA

```{r}
lm_elisa_1m <- subset(merged_long, Method == "ELISA") 
lm_elisa_1m <- lm(lm_elisa_1m$Count_1m_L ~ lm_elisa_1m$Tox_ug_100g)
summary(lm_elisa_1m)
```

#calculate linear regression between net tow and ELISA

```{r}
lm_elisa_net <- subset(merged_long, Method == "ELISA") 
lm_elisa_net <- lm(lm_elisa_net$Count_Net ~ lm_elisa_net$Tox_ug_100g)
summary(lm_elisa_net)
```

#calculate linear regression between 5m and ELISA

```{r}
lm_elisa_5m <- subset(merged_long, Method == "ELISA") 
lm_elisa_5m <- lm(lm_elisa_5m$Count_5m_L ~ lm_elisa_5m$Tox_ug_100g)
summary(lm_elisa_5m)
```

#calculate linear regression between 1m and MBA

```{r}
lm_mba_1m <- subset(merged_long, Method == "MBA") 
lm_mba_1m <- lm(lm_mba_1m$Count_1m_L ~ lm_mba_1m$Tox_ug_100g)
summary(lm_mba_1m)
```

#calculate linear regression between net tow and MBA

```{r}
lm_mba_net <- subset(merged_long, Method == "MBA") 
lm_mba_net <- lm(lm_mba_net$Count_Net ~ lm_mba_net$Tox_ug_100g)
summary(lm_mba_net)
```

#calculate linear regression between 5m and MBA

```{r}
lm_mba_5m <- subset(merged_long, Method == "MBA") 
lm_mba_5m <- lm(lm_mba_5m$Count_5m_L ~ lm_mba_5m$Tox_ug_100g)
summary(lm_mba_5m)
```

