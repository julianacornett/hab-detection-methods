---
title: "phytoplankton_count_plots"
author: "Juliana Cornett"
date: "2023-08-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#code to generate phytoplankton count plots (Figure 3A & 3B in manuscript)

#install packages (ggplot2 & ggpubr for creating figures, patchwork to combine figures; reshape2 for gathering into long format; dplyr for dataframe)

```{r}
#install.packages("ggplot2")
#install.packages("ggpubr")
#install.packages("patchwork")
#install.packages("reshape2")
#install.packages("dplyr")
```

#load libraries

```{r}
library(ggplot2)
library(ggpubr)
library(patchwork)
library(reshape2)
library(dplyr)
```

#read in Alexandrium count data (includes net tow, 1m, & 5m)

```{r}
alex <- read.csv("../Data/Alexandrium_MicroscopeCounts.csv")
```

#put date in date format for timeseries

```{r}
alex$Date <- as.Date(alex$Date, "%m/%d/%Y")
```

#create new categorical column - presence/absence in net tow as alpha values

```{r}
alex$Presence_NetTow <- ifelse(alex$Count_Net==0, "No", "Yes")
```

#1m plot (A) - shaded as presence/absence in net tow

```{r}
plot_1m <- ggplot(alex, aes(x = Date, y = Count_1m_L)) +
  geom_point(size = 5, shape = 21, fill = "#F9B282") +
  theme_pubr() +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y") +
  labs(x = NULL, y = "Alexandrium at 1m (cells/L)") +
annotate("text", x=as.Date("2023-05-04"), y=1500, label = "A", size = 5) +
annotate("rect", xmin=as.Date("2023-05-13"), xmax=as.Date("2023-05-17"), ymin = 0, ymax=Inf, fill = "#F9B282", alpha = 0.25) +
annotate("rect", xmin=as.Date("2023-06-04"), xmax=as.Date("2023-06-15"), ymin = 0, ymax=Inf, fill = "#F9B282", alpha = 0.25) +
annotate("rect", xmin=as.Date("2023-06-24"), xmax=as.Date("2023-07-07"), ymin = 0, ymax=Inf, fill = "#F9B282", alpha = 0.25) +
annotate("rect", xmin=as.Date("2023-08-13"), xmax=as.Date("2023-08-17"), ymin = 0, ymax=Inf, fill = "#F9B282", alpha = 0.25)
plot_1m
```

#5m plot (C) - shape as presence/absence in net tow 

```{r}
plot_5m <- ggplot(alex, aes(x = Date, y = Count_5m_L)) +
  geom_point(size = 5, shape = 21, fill = "#ED7C97") +
  theme_pubr() +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y") +
  labs(x = NULL, y = "Alexandrium at 5m (cells/L)") +
annotate("text", x=as.Date("2023-05-04"), y=1500, label = "B", size = 5) +
annotate("rect", xmin=as.Date("2023-05-13"), xmax=as.Date("2023-05-17"), ymin = 0, ymax=Inf, fill = "#ED7C97", alpha = 0.25) +
annotate("rect", xmin=as.Date("2023-06-04"), xmax=as.Date("2023-06-15"), ymin = 0, ymax=Inf, fill = "#ED7C97", alpha = 0.25) +
annotate("rect", xmin=as.Date("2023-06-24"), xmax=as.Date("2023-07-07"), ymin = 0, ymax=Inf, fill = "#ED7C97", alpha = 0.25) +
annotate("rect", xmin=as.Date("2023-08-13"), xmax=as.Date("2023-08-17"), ymin = 0, ymax=Inf, fill = "#ED7C97", alpha = 0.25)
plot_5m
```

#move count data into long form

```{r}
alex_sub <- select(alex, c("Date", "Count_1m_L", "Count_5m_L"))
```

```{r}
alex_long <- melt(alex_sub, id.vars = "Date", variable.name = "Depth") %>% na.omit()
```

#alternate (combined) Figure 2

```{r}
phyto_combo <- ggplot(alex_long, aes(x = Date, y = value, shape = Depth)) +
  geom_point(size = 5, color = "black") +
  scale_shape_manual(values = c(21, 24), labels = c("1m", "5m")) +
  theme_pubr() +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y") +
  labs(x = NULL, y = "Alexandrium Count (cells/L)") +
annotate("rect", xmin=as.Date("2023-05-13"), xmax=as.Date("2023-05-17"), ymin = 0, ymax=Inf, fill = "darkgray", alpha = 0.25) +
annotate("rect", xmin=as.Date("2023-06-04"), xmax=as.Date("2023-06-15"), ymin = 0, ymax=Inf, fill = "darkgray", alpha = 0.25) +
annotate("rect", xmin=as.Date("2023-06-24"), xmax=as.Date("2023-07-07"), ymin = 0, ymax=Inf, fill = "darkgray", alpha = 0.25) +
annotate("rect", xmin=as.Date("2023-08-13"), xmax=as.Date("2023-08-17"), ymin = 0, ymax=Inf, fill = "darkgray", alpha = 0.25) +
  theme(legend.position = "right")
phyto_combo
```

#save as jpeg
```{r}
jpeg("../Figures/Fig2.jpg", width = 8, height = 5, units="in", res=600)
phyto_combo
```

#regression between collection methods

#remove NAs

```{r}
alex_na <- na.omit(alex)
```

#calculate linear regression between 1m and 5m counts

```{r}
lm_1m_5m <- lm(alex_na$Count_1m_L ~ alex_na$Count_5m_L)
summary(lm_1m_5m)
```

#visualize relationship between 1m and 5m counts

```{r}
plot_1m_5m <- ggplot(alex_na, aes(Count_1m_L, Count_5m_L)) + geom_point() + 
  stat_poly_line() +
  stat_poly_eq(use_label(c("R2", "p")))
plot_1m_5m
```
