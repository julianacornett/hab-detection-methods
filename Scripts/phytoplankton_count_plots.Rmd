---
title: "phytoplankton_count_plots"
author: "Juliana Cornett"
date: "2023-08-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#code to generate phytoplankton count plots (Figure 3A & 3B in manuscript)

#install packages (ggplot2 & ggpubr for creating figures, patchwork to combine figures; reshape2 for gathering into long format)

```{r}
#install.packages("ggplot2")
#install.packages("ggpubr")
#install.packages("patchwork")
#install.packages("reshape2")
```

#load libraries

```{r}
library(ggplot2)
library(ggpubr)
library(patchwork)
library(reshape2)
```

#read in Alexandrium count data (includes net tow, 1m, & 5m)

```{r}
alex <- read.csv("../Data/Alexandrium_MicroscopeCounts.csv")
```

#put date in date format for timeseries

```{r}
alex$Date <- as.Date(alex$Date, "%m/%d/%Y")
```

#create new categorical column - presence/absence in net tow as alpha values

```{r}
alex$Presence_NetTow <- ifelse(alex$Count_Net==0, "No", "Yes")
```

#palettes

```{r}
sunset_5 <- hcl.colors(5, palette = "Sunset")
```

#1m plot (A) - shaded as presence/absence in net tow

```{r}
plot_1m <- ggplot(alex, aes(x = Date, y = Count_1m_L)) +
  geom_point(size = 5, shape = 21, fill = "#F9B282") +
  theme_pubr() +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y") +
  labs(x = NULL, y = "Alexandrium at 1m (cells/L)") +
annotate("text", x=as.Date("2023-05-04"), y=1500, label = "A", size = 5) +
annotate("rect", xmin=as.Date("2023-05-13"), xmax=as.Date("2023-05-17"), ymin = 0, ymax=Inf, fill = "#F9B282", alpha = 0.25) +
annotate("rect", xmin=as.Date("2023-06-04"), xmax=as.Date("2023-06-15"), ymin = 0, ymax=Inf, fill = "#F9B282", alpha = 0.25) +
annotate("rect", xmin=as.Date("2023-06-24"), xmax=as.Date("2023-07-07"), ymin = 0, ymax=Inf, fill = "#F9B282", alpha = 0.25) +
annotate("rect", xmin=as.Date("2023-08-13"), xmax=as.Date("2023-08-17"), ymin = 0, ymax=Inf, fill = "#F9B282", alpha = 0.25)
plot_1m
```

#5m plot (C) - shape as presence/absence in net tow 

```{r}
plot_5m <- ggplot(alex, aes(x = Date, y = Count_5m_L)) +
  geom_point(size = 5, shape = 21, fill = "#ED7C97") +
  theme_pubr() +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y") +
  labs(x = NULL, y = "Alexandrium at 5m (cells/L)") +
annotate("text", x=as.Date("2023-05-04"), y=1500, label = "B", size = 5) +
annotate("rect", xmin=as.Date("2023-05-13"), xmax=as.Date("2023-05-17"), ymin = 0, ymax=Inf, fill = "#ED7C97", alpha = 0.25) +
annotate("rect", xmin=as.Date("2023-06-04"), xmax=as.Date("2023-06-15"), ymin = 0, ymax=Inf, fill = "#ED7C97", alpha = 0.25) +
annotate("rect", xmin=as.Date("2023-06-24"), xmax=as.Date("2023-07-07"), ymin = 0, ymax=Inf, fill = "#ED7C97", alpha = 0.25) +
annotate("rect", xmin=as.Date("2023-08-13"), xmax=as.Date("2023-08-17"), ymin = 0, ymax=Inf, fill = "#ED7C97", alpha = 0.25)
plot_5m
```

#save as jpeg (combined plot)

```{r}
jpeg("../Figures/Fig3.jpg", width = 8, height = 10, units="in", res=600)
plot_1m / plot_5m 
```

#Pearson's correlation between collection methods

#calculate Pearson's correlation between 1m and 5m counts

```{r}
correlation_1m_5m <- cor.test(alex$Count_1m_L, alex$Count_5m_L, method = "pearson")
correlation_1m_5m
```

#visualize relationship between 1m and 5m counts

```{r}
plot_1m_5m <- ggplot(alex, aes(Count_1m_L, Count_5m_L)) + geom_point() + geom_smooth(method = "lm") + theme_pubr()
plot_1m_5m
```
