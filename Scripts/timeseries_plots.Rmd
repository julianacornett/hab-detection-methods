---
title: "timeseries_plots"
author: "Juliana Cornett"
date: "2024-03-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## timeseries plots

#install packages

```{r}
#install.packages("tidyverse")
#install.packages("ggpubr")
#install.packages("patchwork")
```

#load libraries

```{r}
library(tidyverse)
library(ggpubr)
library(patchwork)
```

#read in data

```{r}
psts <- read.csv("../Data/Oyster_PSTs.csv")
alex <- read.csv("../Data/Alexandrium_MicroscopeCounts.csv")
qpcr <- read.csv("../Data/Alexandrium_qPCR_Results.csv")
```

#format 

```{r}
psts$Date <- as.Date(psts$Date, "%m/%d/%Y")
alex$Date <- as.Date(alex$Date, "%m/%d/%Y")
qpcr$Date <- as.Date(qpcr$Date, "%m/%d/%Y")
qpcr <- subset(qpcr, qpcr$Sample_Type == "Sample")
qpcr <- subset(qpcr, qpcr$Quantity_Corrected >= 63.98)
```

#psts timeseries

```{r}
pst_time <- ggplot(psts, aes(x = Date, y = Tox_ug_100g, fill = Method, shape = Method)) + 
  scale_fill_manual(values = c("black", "darkgray"), labels = c("MBA", "ELISA")) +
  scale_shape_manual(values = c(24, 21), labels = c("MBA", "ELISA")) +
  geom_point(size = 4, color = "black", alpha = 0.75) +
  theme_pubr() +
  theme(legend.position = "right") +
  labs(
    x = element_blank(),
    y = "PSTs (\u00b5g/100g)")  +
  geom_hline(yintercept = 80, linetype = "dashed") +
  geom_hline(yintercept = 34, linetype = "dotted")
pst_time
```

#save as jpeg

```{r}
jpeg("../Figures/Fig7.jpg", width = 8, height = 5, units="in", res=600)
pst_time
```

#counts timeseries

#microscope timeseries (A) - one axis for cells (net) and one for cells/L (1m and 5m)

```{r}
counts_time <- ggplot(alex, aes(x=Date)) +
  
  geom_point(aes(y=Count_Net*50), fill = "white", shape = 22, size = 3, alpha = 0.75) + 
  geom_point(aes(y=Count_1m_L), fill = "darkgray", shape = 21, size = 3, alpha = 0.75) +
  geom_point(aes(y=Count_5m_L), fill = "black", shape = 24, size = 3, alpha = 0.75) +
  scale_y_continuous(
    name = "1m or 5m Count (Cells/L)",
    sec.axis = sec_axis(~ . / 50, name = "Net Tow Count (Cells)")
  ) +
  theme_pubr() +
  annotate("text", x=as.Date("2023-10-01"), y=1500, label = "A", size = 5) +
  labs(x = element_blank()) + 
  theme(axis.text.x = element_blank(), axis.ticks.x = element_blank()) 

counts_time

#add legend for different methods
```

#try with gather

```{r}
counts_gathered <- gather(alex, key = Method, value = count, c("Count_Net", "Count_1m_L", "Count_5m_L"))

counts_time_v2 <- ggplot(counts_gathered, aes(x = Date, y = count, group = Method, fill = Method, shape = Method)) +
  scale_fill_manual(values = c("darkgray", "black", "white")) +
  scale_shape_manual(values = c(21, 24, 22), labels = c("1m", "5m", "Net Tow")) +
  guides(fill = "none") +
  geom_point(size = 3, alpha = 0.75) +
  theme_pubr() +
  labs(x = element_blank(), y = "Count (Cells/L for 1m or 5m; Cells for Net Tow)") + 
  theme(axis.text.x = element_blank(), axis.ticks.x = element_blank()) +
  annotate("text", x=as.Date("2023-10-01"), y=1500, label = "A", size = 5) 
counts_time_v2
```

#qpcr timeseries (B)

```{r}
qpcr_mean <- aggregate(Copies_L_Corrected ~ Date, data = qpcr, FUN = mean)
qpcr_time <- ggplot(qpcr_mean, aes(x = Date, y = Copies_L_Corrected)) + 
  geom_point(size = 3, shape = 25) + 
  theme_pubr() + 
  scale_y_continuous(trans="log10") +
  labs(x = element_blank(), y = "qPCR Quantity (Copy Number/L; Log-transformed)") +
  annotate("text", x=as.Date("2023-10-01"), y=1e+09, label = "B", size = 5)
 qpcr_time
```

#save as combined jpeg

```{r}
jpeg("../Figures/Fig8.jpg", width = 8, height = 10, units="in", res=600)
counts_time_v2 /
  qpcr_time
```
