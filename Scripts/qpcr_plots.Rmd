---
title: "qpcr_plots"
author: "Juliana Cornett"
date: "2023-10-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#code to generate qPCR plots (Figures 2 in manuscript) and info for Table 1

#install packages (ggplot2, ggpubr, patchwork, & ggpmisc for creating figures; dplyr, tidyr and reshape2 for data manipulation)

```{r}
#install.packages("ggplot2")
#install.packages("ggpubr")
#install.packages("dplyr")
#install.packages("tidyr")
#install.packages("reshape2")
#install.packages("patchwork")
#install.packages("ggpmisc")
```

#load libraries

```{r}
library(ggplot2)
library(ggpubr)
library(dplyr)
library(tidyr)
library(reshape2)
library(patchwork)
library(ggpmisc)
```

#read in qPCR data 

```{r}
qpcr <- read.csv("../Data/Alexandrium_qPCR_Results.csv")
```

#subset to samples only (not blanks)

```{r}
qpcr_samp <- subset(qpcr, qpcr$Sample_Type == "Sample")
```

#subset to remove values below LOD/LOQ (63.98 copies)

```{r}
qpcr_sub <- subset(qpcr_samp, qpcr_samp$Quantity_Corrected >= 63.98)
```

#create new df with daily mean quantity

```{r}
Quant_dailyMean <- aggregate(Copies_L_Corrected ~ Date, data = qpcr_sub, FUN = mean)
Quant_dailyMean$Date <- as.Date(Quant_dailyMean$Date, "%m/%d/%Y")
write.csv(Quant_dailyMean, "../Data/Alexandrium_qPCR_Results_DailyMean.csv")
Quant_dailyMean[order(Quant_dailyMean$Copies_L_Corrected, decreasing = TRUE),]
```

#regressions

#read in microscope data

```{r}
count_micro <- read.csv("../Data/Alexandrium_MicroscopeCounts.csv")
```

#subset to only ID and count data, reformat date, and remove NAs

```{r}
count_sub <- select(count_micro, c("Date", "Week", "Count_1m_L", "Count_5m_L", "Count_Net")) %>% na.omit()
count_sub$Date <- as.Date(count_sub$Date, "%m/%d/%Y")
```

#merge with qpcr data

```{r}
count_qpcr <- merge(Quant_dailyMean, count_sub)
count_qpcr
```

#add log-transformed qpcr column

```{r}
count_qpcr$log_qpcr <- log(count_qpcr$Copies_L_Corrected)
```

#linear regression between qpcr and net tow

```{r}
lm_net_qpcr <- lm(count_qpcr$log_qpcr ~ count_qpcr$Count_Net)
summary(lm_net_qpcr)
```

#plot of qPCR vs. 1m and 5m - x-axis is copy number/L; y-axis is cells/L (for poster)

#read in csv

```{r}
count_depths <- read.csv("../Data/Count_qPCR_Depths.csv")
count_depths
```

#add log-transformed qpcr column

```{r}
count_depths$log_qpcr <- log(count_depths$Copies_L)
```

```{r}
qpcr_mic_corr <- ggplot(count_depths, aes(x = log_qpcr, y = Count_L, color = Depth, fill = Depth, shape = Depth)) + 
  scale_fill_manual(values = c("darkgray", "black"), labels = c("1m", "5m")) +
  scale_color_manual(values = c("darkgray", "black"), labels = c("1m", "5m")) +
  scale_shape_manual(values = c(21,24)) +
  geom_point(size = 4, color = "black", alpha = 0.75) + 
  stat_poly_line(se = FALSE, size = 2) +
  stat_poly_eq(use_label(c("R2", "p"))) +
  theme_pubr() + 
  labs(
    x = "Mean log-transformed *A. catenella* qPCR Quantity (Copies/L)",
    y = "*A. catenella* Microscope Count (Cells/L)") +
  theme(legend.position = "right", axis.title.x = ggtext::element_markdown(), axis.title.y = ggtext::element_markdown())
qpcr_mic_corr
```

#save as jpeg

```{r}
jpeg("../Figures/Fig2.jpg", width = 8, height = 5, units="in", res=600)
qpcr_mic_corr
```

#calculate linear regression between 1m and qpcr

```{r}
lm_1m_qpcr <- subset(count_depths, Depth == "1m") 
lm_1m_qpcr <- lm(lm_1m_qpcr$log_qpcr ~ lm_1m_qpcr$Count_L)
summary(lm_1m_qpcr)
```

#calculate linear regression between 5m and qpcr

```{r}
lm_5m_qpcr <- subset(count_depths, Depth == "5m") 
lm_5m_qpcr <- lm(lm_5m_qpcr$log_qpcr ~ lm_5m_qpcr$Count_L)
summary(lm_5m_qpcr)
```

#cells per L (based on Vandersea et al., 2018 11,107 copies per cell)

```{r}
Quant_dailyMean_cells <- Quant_dailyMean
Quant_dailyMean_cells$Cells_L = Quant_dailyMean_cells$Copies_L_Corrected/11107
Quant_dailyMean_cells

max(Quant_dailyMean_cells$Cells_L)
min(Quant_dailyMean_cells$Cells_L)

Quant_dailyMean_elevated <- subset(Quant_dailyMean_cells, Cells_L >= 300)
Quant_dailyMean_elevated
```

