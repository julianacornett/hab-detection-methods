---
title: "study_area_map"
author: "Juliana Cornett"
date: "2023-08-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#code to generate sst anomaly map and the study area map (Figures 1 & 2 in manuscript)

#install packages (rnaturalearth & rnaturalearth data for mapping data, ggplot2, ggpubr, viridis, & cowplot for creating figure, ggspatial for scale bar and N arrow)

```{r}
#install.packages("rnaturalearth")
#install.packages("rnaturalearthdata")
#install.packages("ggplot2")
#install.packages("ggpubr")
#install.packages("cowplot")
#install.packages("ggspatial")
#install.packages("viridis")
```

#load libraries 

```{r}
library(rnaturalearth)
library(rnaturalearthdata)
library(ggplot2)
library(ggpubr)
library(cowplot)
library(ggspatial)
library(viridis)
```

#high-resolution coastline data (downloaded from https://www.ngdc.noaa.gov/mgg/shorelines/gshhs.html - store file locally on Desktop and navigate to file with relative path because file is too large to push to GitHub)

```{r}
map_gshhs <- sf::read_sf('../../gshhg-shp-2.3.7/GSHHS_shp/f/GSHHS_f_L1.shp') 
```

#get natural earth land data

```{r}
world <- ne_countries(scale = "large", returnclass = "sf")
```

#put Juneau and Bridget Cove locations into dataframe

```{r}
sites <- data.frame(Location = c("Juneau, AK", "Bridget Cove"), longitude = c(-134.4201, -134.9488), latitude = c(58.3005, 58.6338))
```

#SEAK area base map - ADD INSET

```{r}
seak_area <- ggplot() +
  geom_sf(data = map_gshhs) + 
  coord_sf(xlim = c(-138, -130), ylim = c(54.6,59.6)) + 
  theme_pubr() +
  xlab("Longitude") +
  ylab("Latitude") +
  scale_x_continuous(breaks = c(-138, -136, -134, -132, -130)) +
  annotation_scale(location = "bl", width_hint = 0.4) +
  annotation_north_arrow(location = "bl", which_north = "true", 
        pad_x = unit(0.0, "in"), pad_y = unit(0.2, "in"),
        style = north_arrow_fancy_orienteering) + 
  geom_point(data = sites, aes(x = longitude, y = latitude, fill = Location), size = 5, 
        shape = 21) +
  scale_fill_manual(values = c("black", "white")) +
  theme(legend.position = "right") + 
  geom_rect(aes(xmin = -135.2, xmax = -134.1, ymin = 58.1, ymax = 58.8), fill = "transparent", color = "black") 
seak_area
```

#Bridget Cove inset map 

```{r}
bc_inset <- ggplot() +
  geom_sf(data = map_gshhs) + 
  coord_sf(xlim = c(-135.2, -134.1), ylim = c(58.1, 58.8)) + 
  geom_point(data = sites, aes(x = longitude, y = latitude, fill = Location), size = 5, 
        shape = 21) +
  scale_fill_manual(values = c("black", "white")) +
  theme(legend.position = "none",
        axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank()) +
   theme(panel.background = element_rect(fill = "white"),
        panel.ontop = FALSE)
bc_inset
```

#SEAK map with inset

```{r}
fig1 <- ggdraw(seak_area) +
  draw_plot(
    {bc_inset
      },
    # The distance along a (0,1) x-axis to draw the left edge of the plot
    x = 0.422, 
    # The distance along a (0,1) y-axis to draw the bottom edge of the plot
    y = 0.634,
    # The width and height of the plot expressed as proportion of the entire ggdraw object
    width = 0.35, 
    height = 0.35) 
fig1
```

#save as jpeg

```{r}
jpeg("../Figures/Fig2.jpg", width = 8, height = 5, units="in", res=600)
fig1
```

#read in SST anomaly data - downloaded file with "CRW_SSTANOMALY" variable (sea surface temperature anomaly, Celsius) from NOAA coral reef watch operational daily near-real-time global 5-km satellite coral bleaching monitoring products

```{r}
sst_june_2019 <- read.csv("../Data/sst_june_2019.csv")
sst_june_2023 <- read.csv("../Data/sst_june_2023.csv")
```

#remove first row (descriptor, not data) and make columns numeric

```{r}
sst_june_2019 <- sst_june_2019[-1,]
sst_june_2019$latitude <- as.numeric(sst_june_2019$latitude)
sst_june_2019$longitude <- as.numeric(sst_june_2019$longitude)
sst_june_2019$sst <- as.numeric(sst_june_2019$CRW_SST)
sst_june_2019$anomaly <- as.numeric(sst_june_2019$CRW_SSTANOMALY)
```

```{r}
sst_june_2023 <- sst_june_2023[-1,]
sst_june_2023$latitude <- as.numeric(sst_june_2023$latitude)
sst_june_2023$longitude <- as.numeric(sst_june_2023$longitude)
sst_june_2023$sst <- as.numeric(sst_june_2023$CRW_SST)
sst_june_2023$anomaly <- as.numeric(sst_june_2023$CRW_SSTANOMALY)
```

#create dataframe with mean June sst anomaly by lat and lon
```{r}
mean_june_anomaly_2018 <- aggregate(anomaly ~ latitude + longitude, data = sst_june_2018, FUN = mean, ra.rm = TRUE)
```

```{r}
mean_june_anomaly_2019 <- aggregate(anomaly ~ latitude + longitude, data = sst_june_2019, FUN = mean, na.rm = TRUE)
mean_june_anomaly_2023 <- aggregate(anomaly ~ latitude + longitude, data = sst_june_2023, FUN = mean, na.rm = TRUE)
```

#calculated min and max SST anomaly for each year to set the range for the color scale
#min SST anomaly is -1.29 and max is 3.41 for 2019
#min SST anomaly is -1.22 and max is 2.47 for 2023
#set range for color as (-1.3, 3.5)

#June only SST anomaly plots

```{r}
plot_june_anomaly_2019 <- ggplot() +
  geom_point(data = mean_june_anomaly_2019, aes(x = longitude, y = latitude, color = anomaly)) +
  scale_color_viridis(option = "C", limits = c(-1.3, 3.5)) +
  geom_sf(data = world) +
  coord_sf(xlim = c(-140, -130), ylim = c(55,60)) + 
  theme_pubr() +
  theme(legend.position = "right") + 
  ylab("Latitude") +
  xlab("Longitude") +
  labs(color = "Mean SST Anomaly (C)") +
  annotate("text", x=-130, y=60, label = "A", size = 5) +
  scale_x_discrete(breaks = c(-140, -135, -130))
plot_june_anomaly_2019
```

```{r}
plot_june_anomaly_2023 <- ggplot() +
  geom_point(data = mean_june_anomaly_2023, aes(x = longitude, y = latitude, color = anomaly)) +
  scale_color_viridis(option = "C", limits = c(-1.3, 3.5)) +
  geom_sf(data = world) +
  coord_sf(xlim = c(-140, -130), ylim = c(55,60)) + 
  theme_pubr() +
  theme(legend.position = "right") + 
  ylab("Latitude") +
  xlab("Longitude") +
  labs(color = "Mean SST Anomaly (C)") +
  annotate("text", x=-130, y=60, label = "B", size = 5) +
  scale_x_discrete(breaks = c(-140, -135, -130))
plot_june_anomaly_2023
```

#combined plots

```{r}
jpeg("../Figures/Fig1.jpg", width = 8, height = 10, units = "in", res = 600)
plot_june_anomaly_2019 / plot_june_anomaly_2023
```
